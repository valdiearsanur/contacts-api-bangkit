name: Docker Image CI

on:
  push:
    branches: none
  pull_request:
    branches: none

env:

  REGISTRY: https://gcr.io
  IMAGE_NAME: ${{ GCP_PROJECT_ID }}/node-contact-api
  IMAGE_TAG: ${{ github.run_number }}


jobs:

  build-container:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout branch
      uses: actions/checkout@v3

    - name: Log into Registry
      uses: docker/login-action@v1
      with:
        registry: ${{ env.REGISTRY }}
        username: _json_key
        password: ${{ env.SERVICE_ACCOUNT_KEY }}

    - name: Build and push Docker image
      uses: docker/build-push-action@v2
      with:
        registry: ${{ env.REGISTRY }}
        tags: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ env.IMAGE_TAG }}

